<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <title>Login</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"/>
</head>

<body>
<div class="sidebar">
    <div class="top">
    </div>
    <div class="user">
        <img src="../favicon.ico" alt="alt" class="user-img">
        <div>
            <p class="bold" id="userNameDisplay">None</p>
            <p id="userRoleDisplay">None</p>
        </div>
    </div>
    <ul>
        <li>
            <a href="../index.html">
                <i class="material-symbols-outlined">dataset</i>
                <span class="nav-item">Main Page</span>
            </a>
            <span class="tooltip">Main Page</span>
        </li>
    </ul>
</div>

<div class="main-content">
    <form method="post" id="loginForm">
        <fieldset>
            <legend>Enter Your User Info</legend>
            <p>
                <label for="userID">User ID:</label>
                <input type="text" name="userID" id="userID"/>
            </p>
            <p>
                <label for="password">Password:</label>
                <input type="password" name="password" id="password"/>
            </p>
            <p>
                <input type="submit"/>
                <input type="reset"/>
            </p>
        </fieldset>
    </form>
</div>
</body>

<script>
    const form = document.querySelector("#loginForm");

    form.addEventListener("submit", (event) => {
        event.preventDefault();
        submitForm();
    });

    function submitForm() {
        var userID = document.getElementById('userID').value;
        var password = document.getElementById('password').value;

        var requestData = {
            "userID": userID,
            "password": password
        };

        fetch('../../rest/login/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
            .then(response => response.json()) // Parse JSON response
            .then(data => {
                console.log("Success", data);
                sessionStorage.setItem("username", data.username);
                sessionStorage.setItem("role", data.role);
                alert('Log in successful');
                document.getElementById("loginForm").reset();
                window.location = '../index.html';
            })
            .catch(error => {
                console.error('Network error:', error);
                alert("Error Logging in.");
            });
    }
</script>
</html>